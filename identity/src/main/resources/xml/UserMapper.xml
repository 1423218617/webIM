<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hx.webim.mapper.UserMapper">
    <insert
            id="insertUser" parameterType="com.hx.webim.model.pojo.User"
            useGeneratedKeys="true">
        insert into t_user(username, password,  email, is_active,active, create_date)
         values(#{username},#{password},#{email},#{is_active},#{active},#{create_date})
    </insert>
    <select id="selectUser" parameterType="com.hx.webim.model.pojo.User" resultType="com.hx.webim.model.pojo.User">
        select * from t_user where 1=1
        <if test="id!=null">and id=#{id}</if>
        <if test="active!=null">and active=#{active}</if>
        <if test="email!=null">and email=#{email}</if>
    </select>
    <update id="updateUser" parameterType="com.hx.webim.model.pojo.User" >
        update t_user set 
        <if test="username!=null">username=#{username},</if>
        <if test="password!=null">password=#{password},</if>
        <if test="sign!=null">sign=#{sign},</if>
        <if test="sex!=null">sex=#{sex},</if>
        <if test="is_active!=null">is_active=#{is_active},</if>
        <if test="avatar!=null">avatar=#{avatar},</if>
        <if test="status!=null">status=#{status},</if>
        <if test="birthday!=null">birthday=#{birthday},</if>
        <if test="blood_type!=null">blood_type=#{blood_type},</if>
        <if test="job!=null">job=#{job},</if>
        <if test="phoneNumber!=null">phoneNumber=#{phoneNumber},</if>
        <if test="qq!=qq">qq=#{qq},</if>
        <if test="wechat!=null">wechat=#{wechat}</if>


        where id=#{id}

    </update>
    <select id="UserAllEmail" resultType="String">
        select email from t_user
    </select>
    <select id="findFriendGroupsById" resultType="com.hx.webim.model.vo.FriendList" parameterType="Integer">
        select id, group_name  from t_friend_group where uid = #{id}
    </select>

    <select id="findUsersByFriendGroupIds" resultType="com.hx.webim.model.pojo.User" parameterType="Integer">
        select id,username,avatar,sign,status,email,sex from t_user where id in
        (select uid from t_friend_group_friends where fgid = #{fgid})
    </select>
    <select id="findGroupById" resultType="com.hx.webim.model.vo.GroupList">
        select * from t_group where id in (select gid from t_group_members where uid=#{uid} )
    </select>
    <select id="findGroupMembersByGid" resultType="com.hx.webim.model.pojo.User">
        select * from t_user where id in (select uid from t_group_members where gid=#{gid} )
    </select>
    <insert id="add_msg" parameterType="com.hx.webim.model.pojo.AddMessage">
        insert into t_add_message(from_uid, to_uid, group_id, remark, agree, type, time)
        value (#{from_uid},#{to_uid},#{group_id},#{remark},#{agree},#{type},#{time})
    </insert>
    <select id="get_msg" parameterType="Integer" resultType="com.hx.webim.model.pojo.AddMessage">
        select * from t_add_message where from_uid=#{uid} or to_uid=#{uid}
    </select>
    <update id="updateAddMessage">
        update t_add_message set
        <if test="agree!=null">agree=#{agree},</if>
        <if test="type!=null">type=#{type}</if>
        where id=#{msgIdx}
    </update>
    <insert id="insertFriendAndFriend">
        insert into t_friend_group_friends values (#{from_uid},#{group_id},#{to_uid})
    </insert>
    <select id="selectAddMessageById" resultType="com.hx.webim.model.pojo.AddMessage">
        select * from t_add_message where id=#{id}
    </select>
</mapper>